import { expect, describe, it } from "@jest/globals";
import { deep_close_to_obj, deep_close_to_obj_arrays } from "../test_utilities";
import { two_nodes, two_nodes_array } from "../../src/models/two_nodes";

describe("two_nodes", () => {
  it("should be a function", () => {
    expect(two_nodes).toBeInstanceOf(Function);
  });

  it.each([
    {
      tdb: 25,
      tr: 25,
      v: 0.3,
      rh: 50,
      met: 1.2,
      clo: 0.5,
      wme: undefined,
      body_surface_area: undefined,
      p_atmospheric: undefined,
      body_position: undefined,
      max_skin_blood_flow: undefined,
      kwargs: undefined,
      expected: {
        e_skin: 16.2,
        e_rsw: 7,
        e_max: 159.9,
        q_sensible: 47.6,
        q_skin: 63.8,
        q_res: 5.2,
        t_core: 36.9,
        t_skin: 33.7,
        m_bl: 12.9,
        m_rsw: 10.3,
        w: 0.1,
        w_max: 0.6,
        set: 23.6,
        et: 25,
        pmv_gagge: 0.1,
        pmv_set: -0,
        disc: 0.1,
        t_sens: 0.1,
      },
    },
    {
      tdb: 30,
      tr: 35,
      v: 0.5,
      rh: 60,
      met: 1.5,
      clo: 0.3,
      wme: 0,
      body_surface_area: 1.8258,
      p_atmospheric: 101325,
      body_position: "standing",
      max_skin_blood_flow: 90,
      kwargs: undefined,
      expected: {
        e_skin: 60.4,
        e_rsw: 51.9,
        e_max: 193.8,
        q_sensible: 21.1,
        q_skin: 81.5,
        q_res: 5,
        t_core: 37,
        t_skin: 35.1,
        m_bl: 31.6,
        m_rsw: 76.3,
        w: 0.3,
        w_max: 0.6,
        set: 29.3,
        et: 32.5,
        pmv_gagge: 1.6,
        pmv_set: 1.1,
        disc: 1.9,
        t_sens: 1.4,
      },
    },
    {
      tdb: 30,
      tr: 35,
      v: 0.5,
      rh: 60,
      met: 1.5,
      clo: 0.3,
      wme: 0,
      body_surface_area: 1.8258,
      p_atmospheric: 101325,
      body_position: "sitting",
      max_skin_blood_flow: 90,
      kwargs: undefined,
      expected: {
        e_skin: 60.3,
        e_rsw: 51.8,
        e_max: 193.7,
        q_sensible: 21.2,
        q_skin: 81.5,
        q_res: 5,
        t_core: 37,
        t_skin: 35.1,
        m_bl: 31.6,
        m_rsw: 76.2,
        w: 0.3,
        w_max: 0.6,
        set: 29.1,
        et: 32.4,
        pmv_gagge: 1.6,
        pmv_set: 1.1,
        disc: 1.9,
        t_sens: 1.4,
      },
    },
    {
      tdb: 30,
      tr: 35,
      v: 0.5,
      rh: 60,
      met: 1.5,
      clo: 0.3,
      wme: 0,
      body_surface_area: 1.8258,
      p_atmospheric: 101325,
      body_position: undefined,
      max_skin_blood_flow: 80,
      kwargs: undefined,
      expected: {
        e_skin: 60.4,
        e_rsw: 51.9,
        e_max: 193.8,
        q_sensible: 21.1,
        q_skin: 81.5,
        q_res: 5,
        t_core: 37,
        t_skin: 35.1,
        m_bl: 31.6,
        m_rsw: 76.3,
        w: 0.3,
        w_max: 0.6,
        set: 29.3,
        et: 32.5,
        pmv_gagge: 1.6,
        pmv_set: 1.1,
        disc: 1.9,
        t_sens: 1.4,
      },
    },
  ])(
    "returns $expected when tdb is $tdb, tr is $tr, v is $v, rh is $rh, met is $met, clo is $clo ",
    ({
      tdb,
      tr,
      v,
      rh,
      met,
      clo,
      wme,
      body_surface_area,
      p_atmospheric,
      body_position,
      max_skin_blood_flow,
      kwargs,
      expected,
    }) => {
      const result = two_nodes(
        tdb,
        tr,
        v,
        rh,
        met,
        clo,
        wme,
        body_surface_area,
        p_atmospheric,
        body_position,
        max_skin_blood_flow,
        kwargs,
      );
      deep_close_to_obj(result, expected, 1);
    },
  );
});

describe("two_nodes_array", () => {
  it.each([
    {
      tdb: [25, 30],
      tr: [25, 35],
      v: [0.3, 0.5],
      rh: [50, 60],
      met: [1.2, 1.5],
      clo: [0.5, 0.3],
      wme: [0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["standing"],
      max_skin_blood_flow: [90],
      kwargs: undefined,
      expected: {
        e_skin: [16.2, 60.4],
        e_rsw: [7, 51.9],
        e_max: [159.9, 193.8],
        q_sensible: [47.6, 21.1],
        q_skin: [63.8, 81.5],
        q_res: [5.2, 5],
        t_core: [36.9, 37],
        t_skin: [33.7, 35.1],
        m_bl: [12.9, 31.6],
        m_rsw: [10.3, 76.3],
        w: [0.1, 0.3],
        w_max: [0.6, 0.6],
        set: [23.6, 29.3],
        et: [25, 32.5],
        pmv_gagge: [0.1, 1.6],
        pmv_set: [-0, 1.1],
        disc: [0.1, 1.9],
        t_sens: [0.1, 1.4],
      },
    },
    {
      tdb: [25, 25],
      tr: [25, 25],
      v: [0.3, 0.3],
      rh: [50, 50],
      met: [1.2, 1.2],
      clo: [0.5, 0.5],
      wme: [0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["standing"],
      max_skin_blood_flow: [80],
      kwargs: undefined,
      expected: {
        e_skin: [16.2, 16.2],
        e_rsw: [7, 7],
        e_max: [159.9, 159.9],
        q_sensible: [47.6, 47.6],
        q_skin: [63.8, 63.8],
        q_res: [5.2, 5.2],
        t_core: [36.9, 36.9],
        t_skin: [33.7, 33.7],
        m_bl: [12.9, 12.9],
        m_rsw: [10.3, 10.3],
        w: [0.1, 0.1],
        w_max: [0.6, 0.6],
        set: [23.6, 23.6],
        et: [25, 25],
        pmv_gagge: [0.1, 0.1],
        pmv_set: [-0, -0],
        disc: [0.1, 0.1],
        t_sens: [0.1, 0.1],
      },
    },
    {
      tdb: [30, 30],
      tr: [25, 25],
      v: [0.5, 0.5],
      rh: [60, 60],
      met: [1.2, 1.2],
      clo: [0.5, 0.5],
      wme: [0, 0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["standing", "sitting"],
      max_skin_blood_flow: [80],
      kwargs: undefined,
      expected: {
        e_skin: [27.8, 28.3],
        e_rsw: [20.5, 21],
        e_max: [142.7, 143],
        q_sensible: [37.6, 37.1],
        q_skin: [65.4, 65.4],
        q_res: [4, 4],
        t_core: [36.9, 36.9],
        t_skin: [34.2, 34.2],
        m_bl: [16.6, 16.7],
        m_rsw: [30.1, 30.9],
        w: [0.2, 0.2],
        w_max: [0.6, 0.6],
        set: [26.3, 26.2],
        et: [28.8, 28.9],
        pmv_gagge: [0.8, 0.9],
        pmv_set: [0.7, 0.7],
        disc: [1, 1],
        t_sens: [0.7, 0.7],
      },
    },
    {
      tdb: [20, 30, 35],
      tr: [25, 25, 25],
      v: [0.5, 0.5, 0.2],
      rh: [60, 60, 50],
      met: [1.2, 1.2, 1.0],
      clo: [0.5, 0.5, 0.2],
      wme: [0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["sitting"],
      max_skin_blood_flow: [80],
      kwargs: undefined,
      expected: {
        e_skin: [9.9, 28.3, 24.9],
        e_rsw: [-0, 21, 18.3],
        e_max: [165.1, 143, 129.4],
        q_sensible: [57.1, 37.1, 30.2],
        q_skin: [67, 65.4, 55.2],
        q_res: [5.4, 4, 3.1],
        t_core: [36.8, 36.9, 36.9],
        t_skin: [31.8, 34.2, 34.4],
        m_bl: [6.1, 16.7, 14.4],
        m_rsw: [-0, 30.9, 26.9],
        w: [0.1, 0.2, 0.2],
        w_max: [0.6, 0.6, 0.7],
        set: [19.5, 26.2, 27],
        et: [22.1, 28.9, 30.6],
        pmv_gagge: [-0.5, 0.9, 1.2],
        pmv_set: [-0.6, 0.7, 1.1],
        disc: [-0.2, 1, 1.1],
        t_sens: [-0.2, 0.7, 0.9],
      },
    },
    {
      tdb: [20, 35, 35],
      tr: [25, 25, 25],
      v: [0.2, 0.5, 0.5],
      rh: [60, 50, 50],
      met: [1.2, 1.0, 1.0],
      clo: [0.2, 0.5, 0.5],
      wme: [0, 0],
      body_surface_area: [1.8258, 1.8258],
      p_atmospheric: [101325],
      body_position: ["sitting"],
      max_skin_blood_flow: [80],
      kwargs: undefined,
      expected: {
        e_skin: [9.8, 32.9, 32.9],
        e_rsw: [-0, 26.3, 26.3],
        e_max: [162.8, 136, 136],
        q_sensible: [57.8, 22.2, 22.2],
        q_skin: [67.5, 55.1, 55.1],
        q_res: [5.4, 3.1, 3.1],
        t_core: [36.8, 36.9, 36.9],
        t_skin: [31.5, 34.7, 34.7],
        m_bl: [5.7, 16.7, 16.7],
        m_rsw: [-0, 38.7, 38.7],
        w: [0.1, 0.2, 0.2],
        w_max: [0.7, 0.6, 0.6],
        set: [19.2, 28.5, 28.5],
        et: [22.6, 31.8, 31.8],
        pmv_gagge: [-0.5, 1.7, 1.7],
        pmv_set: [-0.6, 1.4, 1.4],
        disc: [-0.3, 1.6, 1.6],
        t_sens: [-0.3, 1.1, 1.1],
      },
    },
    {
      tdb: [20, 35, 35],
      tr: [25, 25, 25],
      v: [0.2, 0.5, 0.5],
      rh: [60, 50, 50],
      met: [1.2, 1.0, 1.0],
      clo: [0.2, 0.5, 0.5],
      wme: [0, 0, 0],
      body_surface_area: [1.8258, 1.8258, 1.8258],
      p_atmospheric: [101325, 101325, 101325],
      body_position: ["sitting", "sitting", "sitting"],
      max_skin_blood_flow: [80, 80, 80],
      kwargs: undefined,
      expected: {
        e_skin: [9.8, 32.9, 32.9],
        e_rsw: [-0, 26.3, 26.3],
        e_max: [162.8, 136, 136],
        q_sensible: [57.8, 22.2, 22.2],
        q_skin: [67.5, 55.1, 55.1],
        q_res: [5.4, 3.1, 3.1],
        t_core: [36.8, 36.9, 36.9],
        t_skin: [31.5, 34.7, 34.7],
        m_bl: [5.7, 16.7, 16.7],
        m_rsw: [-0, 38.7, 38.7],
        w: [0.1, 0.2, 0.2],
        w_max: [0.7, 0.6, 0.6],
        set: [19.2, 28.5, 28.5],
        et: [22.6, 31.8, 31.8],
        pmv_gagge: [-0.5, 1.7, 1.7],
        pmv_set: [-0.6, 1.4, 1.4],
        disc: [-0.3, 1.6, 1.6],
        t_sens: [-0.3, 1.1, 1.1],
      },
    },
    {
      tdb: [20, 35, 35],
      tr: [25, 25, 25],
      v: [0.2, 0.5, 0.5],
      rh: [60, 50, 50],
      met: [1.2, 1.0, 1.0],
      clo: [0.2, 0.5, 0.5],
      wme: [0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: undefined,
      max_skin_blood_flow: [80, 80, 80],
      kwargs: undefined,
      expected: {
        e_skin: [9.7, 32.2, 32.2],
        e_rsw: [-0, 25.6, 25.6],
        e_max: [161.9, 135.6, 135.6],
        q_sensible: [58, 22.9, 22.9],
        q_skin: [67.7, 55.1, 55.1],
        q_res: [5.4, 3.1, 3.1],
        t_core: [36.8, 36.9, 36.9],
        t_skin: [31.5, 34.6, 34.6],
        m_bl: [5.6, 16.5, 16.5],
        m_rsw: [-0, 37.7, 37.7],
        w: [0.1, 0.2, 0.2],
        w_max: [0.7, 0.6, 0.6],
        set: [19.2, 28.5, 28.5],
        et: [22.7, 31.7, 31.7],
        pmv_gagge: [-0.5, 1.7, 1.7],
        pmv_set: [-0.6, 1.4, 1.4],
        disc: [-0.3, 1.5, 1.5],
        t_sens: [-0.3, 1.1, 1.1],
      },
    },
    {
      tdb: [20, 25, 30],
      tr: [25, 25, 35],
      v: [0.2, 0.4, 0.6],
      rh: [60, 50, 80],
      met: [1.2, 1.5, 1.0],
      clo: [0.2, 0.3, 0.4],
      wme: undefined,
      body_surface_area: undefined,
      p_atmospheric: undefined,
      body_position: undefined,
      max_skin_blood_flow: undefined,
      kwargs: undefined,
      expected: {
        e_skin: [9.7, 22.3, 36.5],
        e_rsw: [-0, 10.5, 30.7],
        e_max: [161.9, 206.9, 127.2],
        q_sensible: [58, 57.4, 18.8],
        q_skin: [67.7, 79.7, 55.3],
        q_res: [5.4, 6.4, 2.5],
        t_core: [36.8, 36.9, 36.9],
        t_skin: [31.5, 33.4, 34.8],
        m_bl: [5.6, 15.1, 18.2],
        m_rsw: [-0, 15.5, 45.2],
        w: [0.1, 0.1, 0.3],
        w_max: [0.7, 0.6, 0.6],
        set: [19.2, 22.4, 29.9],
        et: [22.7, 25, 33.9],
        pmv_gagge: [-0.5, -0.1, 2],
        pmv_set: [-0.6, -0.3, 1.8],
        disc: [-0.3, -0, 2],
        t_sens: [-0.3, -0, 1.3],
      },
    },
    {
      tdb: [20, 25, 30, 35],
      tr: [50, 50, 25, 25],
      v: [0.2, 0.8, 0.5, 0.2],
      rh: [60, 50, 50, 10],
      met: [1.1, 1.0, 1.0, 1.3],
      clo: [0.8, 0.5, 0.5, 0.2],
      wme: [0],
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["standing"],
      max_skin_blood_flow: undefined,
      kwargs: undefined,
      expected: {
        e_skin: [64.6, 50.9, 17.7, 38.4],
        e_rsw: [59.7, 39.5, 8.5, 24],
        e_max: [140.6, 229.4, 161.1, 263.8],
        q_sensible: [-7.2, 2.1, 36.4, 30.4],
        q_skin: [57.3, 53, 54.1, 68.8],
        q_res: [4.9, 4.3, 3.8, 6.9],
        t_core: [37, 36.9, 36.8, 36.9],
        t_skin: [35.6, 35.1, 34, 34.3],
        m_bl: [31.5, 21.1, 12, 18.2],
        m_rsw: [87.8, 58, 12.6, 35.4],
        w: [0.5, 0.2, 0.1, 0.1],
        w_max: [0.7, 0.6, 0.6, 0.7],
        set: [34.4, 29.6, 24.8, 25.2],
        et: [33.4, 33.1, 28.1, 28.3],
        pmv_gagge: [3.4, 2.6, 0.6, 0.8],
        pmv_set: [2.6, 1, 0.3, -0],
        disc: [3.1, 1.5, 0.4, 0.5],
        t_sens: [2.4, 1.6, 0.4, 0.7],
      },
    },
    {
      tdb: [20, 25, 30, 35, 40],
      tr: [50, 50, 25, 25, 25],
      v: [0.2, 0.8, 0.5, 0.2, 0.2],
      rh: [60, 50, 50, 10, 50],
      met: [1.1, 1.0, 1.0, 1.3, 1.3],
      clo: [0.8, 0.5, 0.5, 0.2, 0.2],
      wme: undefined,
      body_surface_area: [1.8258],
      p_atmospheric: [101325],
      body_position: ["standing"],
      max_skin_blood_flow: undefined,
      kwargs: undefined,
      expected: {
        e_skin: [64.6, 50.9, 17.7, 38.4, 53.6],
        e_rsw: [59.7, 39.5, 8.5, 24, 50.1],
        e_max: [140.6, 229.4, 161.1, 263.8, 107.7],
        q_sensible: [-7.2, 2.1, 36.4, 30.4, 19.6],
        q_skin: [57.3, 53, 54.1, 68.8, 73.2],
        q_res: [4.9, 4.3, 3.8, 6.9, 2.8],
        t_core: [37, 36.9, 36.8, 36.9, 37],
        t_skin: [35.6, 35.1, 34, 34.3, 35.1],
        m_bl: [31.5, 21.1, 12, 18.2, 29.4],
        m_rsw: [87.8, 58, 12.6, 35.4, 73.7],
        w: [0.5, 0.2, 0.1, 0.1, 0.5],
        w_max: [0.7, 0.6, 0.6, 0.7, 0.7],
        set: [34.4, 29.6, 24.8, 25.2, 32.8],
        et: [33.4, 33.1, 28.1, 28.3, 35.5],
        pmv_gagge: [3.4, 2.6, 0.6, 0.8, 2.1],
        pmv_set: [2.6, 1, 0.3, -0, 2.4],
        disc: [3.1, 1.5, 0.4, 0.5, 3.3],
        t_sens: [2.4, 1.6, 0.4, 0.7, 1.8],
      },
    },
  ])(
    "returns $expected when tdb is $tdb, tr is $tr, v is $v, rh is $rh, met is $met, clo is $clo ",
    ({
      tdb,
      tr,
      v,
      rh,
      met,
      clo,
      wme,
      body_surface_area,
      p_atmospheric,
      body_position,
      max_skin_blood_flow,
      kwargs,
      expected,
    }) => {
      const result = two_nodes_array(
        tdb,
        tr,
        v,
        rh,
        met,
        clo,
        wme,
        body_surface_area,
        p_atmospheric,
        body_position,
        max_skin_blood_flow,
        kwargs,
      );
      deep_close_to_obj_arrays(result, expected, 1);
    },
  );
});
