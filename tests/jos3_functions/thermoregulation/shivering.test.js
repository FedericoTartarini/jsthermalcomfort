import {
  shivering,
  PRE_SHIV,
  set_pre_shiv,
} from "../../../src/jos3_functions/thermoregulation/shivering";
import { describe, it, expect, beforeEach } from "@jest/globals";
import { $lerp } from "../../../src/supa";
import * as math from "mathjs";

describe("shivering", () => {
  beforeEach(() => {
    set_pre_shiv(0);
  });

  it.each([
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015669935303199344, 0.020153663103819806, 0.12662601996927517,
        0.11140907984593233, 0.17913648163427354, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292,
      ],
      preShiv: 0.462,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015280380711561809, 0.019652643039058844, 0.123478097112839,
        0.10863945012096246, 0.1746831487008455, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842,
      ],
      preShiv: 0.462,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014890826119924271, 0.019151622974297886, 0.1203301742564028,
        0.10586982039599258, 0.17022981576741747, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393,
      ],
      preShiv: 0.462,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014544520549723567, 0.018706227019703467, 0.11753173921508184,
        0.10340767973139747, 0.16627089952330001, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737,
      ],
      preShiv: 0.462,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014111560237296168, 0.018149381308144925, 0.11403306228333074,
        0.10032944685525436, 0.16132135853574503, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688,
      ],
      preShiv: 0.462,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.013505603839121449, 0.017370039155920215, 0.10913643409111888,
        0.09602125773761215, 0.15439415079094768, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543,
      ],
      preShiv: 0.462,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": true,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.4505044992533, 18.585309621458524, 116.77201187390706,
        102.73925057256729, 165.1961213463311, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276,
      ],
      preShiv: 426.047265,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.091264957401865, 18.123278824269065, 113.86905965872175,
        100.18515280333327, 161.08934576966132, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526,
      ],
      preShiv: 426.047265,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.732025415550426, 17.66124802707961, 110.9661074435364,
        97.63105503409923, 156.98257019299152, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758,
      ],
      preShiv: 426.047265,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.41266926611693, 17.250512684445372, 108.38544598112307,
        95.3605175964455, 153.3317359112376, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459,
      ],
      preShiv: 426.047265,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.013401826802559, 16.737000579604473, 105.159035293047,
        92.52183210312546, 148.76736707843847, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498,
      ],
      preShiv: 426.047265,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        12.454600817816434, 16.018306656542673, 100.64346159388302,
        88.54890528348429, 142.37923306597585, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508,
      ],
      preShiv: 426.047265,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": false,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.6280452263064251, 2.093887075721538, 13.15595012667794,
        11.574969334642319, 18.61158250745699, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577,
      ],
      preShiv: 48,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5875720219804474, 2.0418330430191007, 12.828893206528726,
        11.287215596983112, 18.148898566321613, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925,
      ],
      preShiv: 48,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5470988176544695, 1.9897790103166633, 12.501836286379511,
        10.999461859323903, 17.686214625186228, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277,
      ],
      preShiv: 48,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5111190181530978, 1.9435041059432172, 12.21108978857993,
        10.743655037028308, 17.27489865177143, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422,
      ],
      preShiv: 48,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.466136128550251, 1.8856500060410313, 11.847590886579816,
        10.42383863431214, 16.76066062709039, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726,
      ],
      preShiv: 48,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.4031796196489816, 1.8046793928228793, 11.338850295181182,
        9.976234570141521, 16.04095073152703, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855,
      ],
      preShiv: 48,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: true,
        "limit_dshiv/dt": 0.8,
      },
      expected: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      preShiv: 0,
    },
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015669935303199344, 0.020153663103819806, 0.12662601996927517,
        0.11140907984593233, 0.17913648163427354, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292,
      ],
      preShiv: 0.462,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015280380711561809, 0.019652643039058844, 0.123478097112839,
        0.10863945012096246, 0.1746831487008455, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842,
      ],
      preShiv: 0.462,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014890826119924271, 0.019151622974297886, 0.1203301742564028,
        0.10586982039599258, 0.17022981576741747, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393,
      ],
      preShiv: 0.462,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014544520549723567, 0.018706227019703467, 0.11753173921508184,
        0.10340767973139747, 0.16627089952330001, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737,
      ],
      preShiv: 0.462,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014111560237296168, 0.018149381308144925, 0.11403306228333074,
        0.10032944685525436, 0.16132135853574503, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688,
      ],
      preShiv: 0.462,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.013505603839121449, 0.017370039155920215, 0.10913643409111888,
        0.09602125773761215, 0.15439415079094768, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543,
      ],
      preShiv: 0.462,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015669935303199344, 0.020153663103819806, 0.12662601996927517,
        0.11140907984593233, 0.17913648163427354, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0011232431500523424,
        0.0006332687718402095, 9.244799588908168e-5, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292, 0.0018027359198370925,
        0.0008089199640294646, 0.00016178399280589292,
      ],
      preShiv: 0.462,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.015280380711561809, 0.019652643039058844, 0.123478097112839,
        0.10863945012096246, 0.1746831487008455, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.001095319325342041,
        0.0006175257101722618, 9.01497387112791e-5, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842, 0.0017579199048699424,
        0.0007888102137236921, 0.00015776204274473842,
      ],
      preShiv: 0.462,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014890826119924271, 0.019151622974297886, 0.1203301742564028,
        0.10586982039599258, 0.17022981576741747, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.00106739550063174,
        0.0006017826485043143, 8.785148153347654e-5, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393, 0.0017131038899027922,
        0.0007687004634179197, 0.00015374009268358393,
      ],
      preShiv: 0.462,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014544520549723567, 0.018706227019703467, 0.11753173921508184,
        0.10340767973139747, 0.16627089952330001, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0010425718270155831,
        0.0005877874086466456, 8.580838082432783e-5, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737, 0.0016732634260743925,
        0.0007508233322128684, 0.0001501646664425737,
      ],
      preShiv: 0.462,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.014111560237296168, 0.018149381308144925, 0.11403306228333074,
        0.10032944685525436, 0.16132135853574503, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0010115366187796369,
        0.0005702901924807006, 8.32540426979125e-5, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688, 0.0016234538326092935,
        0.0007284728736067343, 0.00014569457472134688,
      ],
      preShiv: 0.462,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.013505603839121449, 0.017370039155920215, 0.10913643409111888,
        0.09602125773761215, 0.15439415079094768, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0009681008061671127,
        0.0005458016890736397, 7.967907869688171e-5, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543, 0.0015537420345891932,
        0.000697191938597715, 0.000139438387719543,
      ],
      preShiv: 0.462,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": true,
      },
      expected: [
        0.012942896462383561, 0.016646321113862043, 0.1045892937140222,
        0.09202055768034471, 0.14796135973546093, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0009277651446487331,
        0.0005230610074768578, 7.63592711645048e-5, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339, 0.0014890057877078432,
        0.0006681436226894168, 0.00013362872453788339,
      ],
      preShiv: 0.462,
    },
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.4505044992533, 18.585309621458524, 116.77201187390706,
        102.73925057256729, 165.1961213463311, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276,
      ],
      preShiv: 426.047265,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.091264957401865, 18.123278824269065, 113.86905965872175,
        100.18515280333327, 161.08934576966132, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526,
      ],
      preShiv: 426.047265,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.732025415550426, 17.66124802707961, 110.9661074435364,
        97.63105503409923, 156.98257019299152, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758,
      ],
      preShiv: 426.047265,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.41266926611693, 17.250512684445372, 108.38544598112307,
        95.3605175964455, 153.3317359112376, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459,
      ],
      preShiv: 426.047265,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.013401826802559, 16.737000579604473, 105.159035293047,
        92.52183210312546, 148.76736707843847, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498,
      ],
      preShiv: 426.047265,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        12.454600817816434, 16.018306656542673, 100.64346159388302,
        88.54890528348429, 142.37923306597585, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508,
      ],
      preShiv: 426.047265,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.4505044992533, 18.585309621458524, 116.77201187390706,
        102.73925057256729, 165.1961213463311, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.035832623397803,
        0.5839879399403252, 0.08525371385990149, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276, 1.6624474202680788,
        0.745969996274138, 0.1491939992548276,
      ],
      preShiv: 426.047265,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        14.091264957401865, 18.123278824269065, 113.86905965872175,
        100.18515280333327, 161.08934576966132, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.0100818243801337,
        0.5694699997534086, 0.08313430653334433, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526, 1.6211189774002144,
        0.7274251821667629, 0.1454850364333526,
      ],
      preShiv: 426.047265,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.732025415550426, 17.66124802707961, 110.9661074435364,
        97.63105503409923, 156.98257019299152, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 0.9843310253624643,
        0.5549520595664923, 0.0810148992067872, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758, 1.57979053453235,
        0.7088803680593878, 0.14177607361187758,
      ],
      preShiv: 426.047265,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.41266926611693, 17.250512684445372, 108.38544598112307,
        95.3605175964455, 153.3317359112376, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 0.9614391243853728,
        0.542045926093811, 0.07913079213048337, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459, 1.5430504465444255,
        0.6923944311417294, 0.1384788862283459,
      ],
      preShiv: 426.047265,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        13.013401826802559, 16.737000579604473, 105.159035293047,
        92.52183210312546, 148.76736707843847, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 0.9328190690008915,
        0.5259103393132598, 0.07677523201653429, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498, 1.4971170243224183,
        0.6717832801446749, 0.13435665602893498,
      ],
      preShiv: 426.047265,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        12.454600817816434, 16.018306656542673, 100.64346159388302,
        88.54890528348429, 142.37923306597585, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 0.8927634214540985,
        0.5033275256757674, 0.07347847090157189, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508, 1.4328301825806518,
        0.6429366203887541, 0.1285873240777508,
      ],
      preShiv: 426.047265,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": false,
      },
      expected: [
        11.935683201248247, 15.350908188036097, 96.45017864749101,
        84.85953879542339, 136.4470403484291, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 0.8555666719478834,
        0.4823565187525104, 0.07041701003686283, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994, 1.373131695718825,
        0.6161488378225497, 0.12322976756450994,
      ],
      preShiv: 426.047265,
    },
    {
      age: 21,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.6280452263064251, 2.093887075721538, 13.15595012667794,
        11.574969334642319, 18.61158250745699, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577,
      ],
      preShiv: 48,
    },
    {
      age: 31,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5875720219804474, 2.0418330430191007, 12.828893206528726,
        11.287215596983112, 18.148898566321613, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925,
      ],
      preShiv: 48,
    },
    {
      age: 41,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5470988176544695, 1.9897790103166633, 12.501836286379511,
        10.999461859323903, 17.686214625186228, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277,
      ],
      preShiv: 48,
    },
    {
      age: 51,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5111190181530978, 1.9435041059432172, 12.21108978857993,
        10.743655037028308, 17.27489865177143, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422,
      ],
      preShiv: 48,
    },
    {
      age: 61,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.466136128550251, 1.8856500060410313, 11.847590886579816,
        10.42383863431214, 16.76066062709039, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726,
      ],
      preShiv: 48,
    },
    {
      age: 71,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.4031796196489816, 1.8046793928228793, 11.338850295181182,
        9.976234570141521, 16.04095073152703, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855,
      ],
      preShiv: 48,
    },
    {
      age: 81,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
    {
      age: 91,
      sex: "male",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
    {
      age: 21,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.6280452263064251, 2.093887075721538, 13.15595012667794,
        11.574969334642319, 18.61158250745699, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.11670058701842517,
        0.06579415811326851, 0.009604986585878616, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577, 0.18729723842463297,
        0.08404363262643788, 0.016808726525287577,
      ],
      preShiv: 48,
    },
    {
      age: 31,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5875720219804474, 2.0418330430191007, 12.828893206528726,
        11.287215596983112, 18.148898566321613, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.11379941042514713,
        0.06415851534257265, 0.009366206619353673, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925, 0.1826410290773966,
        0.08195430791934463, 0.016390861583868925,
      ],
      preShiv: 48,
    },
    {
      age: 41,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5470988176544695, 1.9897790103166633, 12.501836286379511,
        10.999461859323903, 17.686214625186228, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.11089823383186907,
        0.0625228725718768, 0.009127426652828731, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277, 0.17798481973016023,
        0.07986498321225138, 0.015972996642450277,
      ],
      preShiv: 48,
    },
    {
      age: 51,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.5111190181530978, 1.9435041059432172, 12.21108978857993,
        10.743655037028308, 17.27489865177143, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.10831915085876187,
        0.06106882167757356, 0.008915156449280813, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422, 0.17384555076097585,
        0.07800761893120711, 0.015601523786241422,
      ],
      preShiv: 48,
    },
    {
      age: 61,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.466136128550251, 1.8856500060410313, 11.847590886579816,
        10.42383863431214, 16.76066062709039, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.10509471363944278,
        0.05925092908890396, 0.008649770669912987, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726, 0.1686705280633032,
        0.07568549336173863, 0.015137098672347726,
      ],
      preShiv: 48,
    },
    {
      age: 71,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.4031796196489816, 1.8046793928228793, 11.338850295181182,
        9.976234570141521, 16.04095073152703, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.10058190193944028,
        0.05670666899466386, 0.008278345838637062, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855, 0.16142774385342265,
        0.07243552608807428, 0.014487105217614855,
      ],
      preShiv: 48,
    },
    {
      age: 81,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
    {
      age: 91,
      sex: "female",
      options: {
        shivering_threshold: false,
        "limit_dshiv/dt": 0.8,
      },
      expected: [
        1.3447165155723177, 1.7294879079337186, 10.866420126132176,
        9.560577421334516, 15.372608803684251, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.09639118385960863,
        0.05434400077681639, 0.00793343077033816, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178, 0.1547019000215941,
        0.06941751924045889, 0.01388350384809178,
      ],
      preShiv: 48,
    },
  ])(
    "works correctly with given age $age and options $options",
    ({ age, sex, expected, options }) => {
      const result = shivering(
        math.matrix($lerp(17, -5, -1)),
        math.matrix($lerp(17, -5, -1)),
        math.matrix($lerp(17, 36, 38)),
        math.matrix($lerp(17, 30, 34)),
        1.72,
        74.43,
        "dubois",
        age,
        sex,
        60,
        options,
      ).toArray();

      expect(result).toHaveLength(expected.length);

      for (let i = 0; i < expected.length; i++) {
        expect(result[i]).toBeCloseTo(expected[i], 13);
      }
    },
  );
});
