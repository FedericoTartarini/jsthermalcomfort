import { nonshivering } from "../../../src/jos3_functions/thermoregulation/nonshivering";
import { describe, it, expect } from "@jest/globals";
import { $lerp } from "../../../src/supa";
import * as math from "mathjs";

describe("nonshivering", () => {
  it.each([
    {
      age: 21,
      cold_acclimation: true,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 21,
      cold_acclimation: false,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 21,
      cold_acclimation: true,
      batpositive: false,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 21,
      cold_acclimation: false,
      batpositive: false,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 31,
      cold_acclimation: true,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 31,
      cold_acclimation: false,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 31,
      cold_acclimation: true,
      batpositive: false,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 31,
      cold_acclimation: false,
      batpositive: false,
      expected: [
        0.0, 1.7119191341440272, 0.0, 1.7119191341440272, 1.7119191341440272,
        1.937171651794557, 0.0, 0.0, 1.937171651794557, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 41,
      cold_acclimation: true,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 41,
      cold_acclimation: false,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 41,
      cold_acclimation: true,
      batpositive: false,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 41,
      cold_acclimation: false,
      batpositive: false,
      expected: [
        0.0, 1.6293963413904133, 0.0, 1.6293963413904133, 1.6293963413904133,
        1.8437905968365205, 0.0, 0.0, 1.8437905968365205, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0,
      ],
    },
    {
      age: 51,
      cold_acclimation: true,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 51,
      cold_acclimation: false,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 51,
      cold_acclimation: true,
      batpositive: false,
      expected: [
        0.0, 1.7242978894934908, 0.0, 1.7242978894934908, 1.7242978894934908,
        1.9511791907426344, 0.0, 0.0, 1.9511791907426344, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0,
      ],
    },
    {
      age: 51,
      cold_acclimation: false,
      batpositive: false,
      expected: [
        0.0, 1.5763060571132577, 0.0, 1.5763060571132577, 1.5763060571132577,
        1.7837147488386864, 0.0, 0.0, 1.7837147488386864, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0,
      ],
    },
    {
      age: 61,
      cold_acclimation: true,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 61,
      cold_acclimation: false,
      batpositive: true,
      expected: [
        0.0, 1.861862716480607, 0.0, 1.861862716480607, 1.861862716480607,
        2.106844652859634, 0.0, 0.0, 2.106844652859634, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
      ],
    },
    {
      age: 61,
      cold_acclimation: true,
      batpositive: false,
      expected: [
        0.0, 1.5302944774063898, 0.0, 1.5302944774063898, 1.5302944774063898,
        1.7316490139072307, 0.0, 0.0, 1.7316490139072307, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0,
      ],
    },
    {
      age: 61,
      cold_acclimation: false,
      batpositive: false,
      expected: [
        0.0, 1.5302944774063898, 0.0, 1.5302944774063898, 1.5302944774063898,
        1.7316490139072307, 0.0, 0.0, 1.7316490139072307, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0,
      ],
    },
  ])(
    "returns correct result when age is $age, cold_acclimation is $cold_acclimation, and batpositive is $batpositive",
    ({ age, cold_acclimation, batpositive, expected }) => {
      const result = nonshivering(
        math.matrix($lerp(17, -5, -1)),
        1.72,
        74.43,
        "dubois",
        age,
        cold_acclimation,
        batpositive,
      ).toArray();

      expect(result).toHaveLength(expected.length);

      for (let i = 0; i < expected.length; i++) {
        expect(result[i]).toBeCloseTo(expected[i], 14);
      }
    },
  );
});
